!function($){window.luvmaps=[],window.init_luvmaps=function(){jQuery(function(){jQuery(".luvmap").each(function(){jQuery(this).luvmap(),jQuery(this).trigger("luvmap-init")})})},"undefined"==typeof google?$.getScript("//maps.google.com/maps/api/js?key="+luvthemes_core.google_maps_api_key+"&v=3&callback=init_luvmaps"):init_luvmaps(),$.fn.luvmap=function(){$(this).each(function(){var e=$(this).data();e=$.extend({type:"roadmap",search:!0,center:null,addresses:null,animation:"drop",delay:1e3,zoom:null,tilt:null,controls:!1,disableUi:!1,useClusters:!1,panorama:!1,scrollwheel:!0,draggable:!0,panoramaHeading:0,panoramaPitch:0,panoramaControls:!0,panoramaEffect:"slideLeft",mapStyle:null},e),null==e.addresses?(e.addresses=[],$(this).children(".luvmap-address").each(function(){var o=$(this).clone().children().remove().end();if($(this).children(".luvmap-info").length>0){var n=$(this).children(".luvmap-info");$(n).find(".luvmap-street_view").each(function(){$(this).attr("href",$(o).text())});var a=n.html()}var t=!!$(this).hasClass("auto-open");e.addresses.push({address:$(o).text(),icon:$(this).children(".luvmap-icon").attr("src"),info:a,auto_open:t}),$(this).remove()})):e.addresses=e.addresses.replace(/\s+/,"").split(",");var o,n,a=[],t=[],i,s=$(this),r,l=new google.maps.Geocoder,p=function(e){var o=e.match(/([\d\.-]),([\d\.-])/);return null!==o&&3==o.length&&!isNaN(o[1])&&!isNaN(o[2])&&new google.maps.LatLng(parseFloat(o[1]),parseFloat(o[2]))},d=function(o){o=o||0;try{var n=p(e.addresses[o].address);n!==!1?(t.push({position:n,icon:e.addresses[o].icon,info:new google.maps.InfoWindow({content:e.addresses[o].info}),auto_open:e.addresses[o].auto_open}),"undefined"==typeof e.addresses[o+1]?c(s[0]):(o++,d(o))):l.geocode({address:e.addresses[o].address},function(n,a){a==google.maps.GeocoderStatus.OK?(t.push({position:n[0].geometry.location,icon:e.addresses[o].icon,info:new google.maps.InfoWindow({content:e.addresses[o].info}),auto_open:e.addresses[o].auto_open}),"undefined"==typeof e.addresses[o+1]?c(s[0]):(o++,d(o))):a==google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&setTimeout(function(){d(o)},1e3)})}catch(e){c(s[0])}},c=function(a){if(null==e.center&&t.length>0){i=new google.maps.LatLngBounds;for(var p in t)i.extend(t[p].position);var d=i.getCenter()}if(e.type.match(/^panorama$/i))n=new google.maps.StreetViewPanorama(a,{position:d,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},disableDefaultUI:!e.panoramaControls});else{if(o=new google.maps.Map(a,{zoom:e.zoom||12,center:d,mapTypeControl:e.controls,disableDefaultUI:e.disableUi,scrollwheel:e.scrollwheel,draggable:e.draggable,styles:JSON.parse(decodeURIComponent(e.mapStyle)),mapTypeId:google.maps.MapTypeId[e.type.toUpperCase()]}),window.luvmaps.push(o),$(document).on("click",".luvmap-goto",function(e){e.preventDefault(),l.geocode({address:$(this).attr("href")},function(e,n){n==google.maps.GeocoderStatus.OK&&o.setCenter(e[0].geometry.location)})}),1==e.panorama){e.panoramaEffect.match(/^slide/)?"slideLeft"==e.panoramaEffect?r="0 0 0 "+$(s).css("width"):"slideRight"==e.panoramaEffect?r="0 0 0 -"+$(s).css("width"):"slideUp"==e.panoramaEffect?r=$(s).css("height")+" 0 0 0":"slideDown"==e.panoramaEffect&&(r="-"+$(s).css("height")+" 0 0 0"):r="0";var c=$("<div>",{class:"panorama-pseudo-container",style:"position:absoulute;top:0px;left:-0px;z-index:1;width:100%;height:100%;transition: margin 0.8s ease;margin:"+r}).prependTo($(s)).get(0);n=new google.maps.StreetViewPanorama(c,{position:d,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},disableDefaultUI:!e.panoramaControls});var m=document.createElement("div"),f=new h("panoramaSlideOut",m,n);n.controls[google.maps.ControlPosition.TOP_RIGHT].push(m),$(document).on("click",".luvmap-street_view",function(e){e.preventDefault(),l.geocode({address:$(this).attr("href")},function(e,o){o==google.maps.GeocoderStatus.OK&&(n.setPosition(e[0].geometry.location),$(s).find(".panorama-pseudo-container").css("margin","0"))})})}null==e.zoom&&o.fitBounds(i),null!=e.tilt&&o.setTilt(e.tilt)}t.length>0&&setTimeout(u,e.delay)};d(0);var u=function(){g();for(var n in t)"none"!=e.animation?f(t[n],200*n):m(t[n]);if(1==e.useClusters)if("none"!=e.animation)setTimeout(function(){var e=new MarkerClusterer(o,a,{imagePath:luvthemes_core.google_maps_cluster_path})},200*t.length);else var i=new MarkerClusterer(o,a,{imagePath:luvthemes_core.google_maps_cluster_path})},m=function(e){var n=new google.maps.Marker({position:e.position,map:o,icon:e.icon,info:e.info});a.push(n),console.log(e),e.auto_open&&e.info.open(o,n),"undefined"!=typeof e.info.content&&n.addListener("click",function(){e.info.open(o,n)})},f=function(n,t){window.setTimeout(function(){var t=new google.maps.Marker({position:n.position,map:o,animation:google.maps.Animation[e.animation.toUpperCase()],icon:n.icon,info:n.info});a.push(t),console.log(n),n.auto_open&&setTimeout(function(){n.info.open(o,t)},500),"undefined"!=typeof n.info.content&&t.addListener("click",function(){n.info.open(o,t)})},t)},g=function(){for(var e=0;e<a.length;e++)a[e].setMap(null);a=[]},h=function(e,o,n){var a=document.createElement("div"),a=$("<div>",{style:"background: #fff;border: 2px solid #fff;border-radius:3px;box-shadow:0 2px 6px rgba(0,0,0,.3);cursor:pointer;margin:0 0 22px 0 text-align:center;"}).appendTo($(o)),t=$("<div>",{style:"color:rgb(25,25,25);font-family:Roboto,Arial,sans-serif;font-size:16px;line-height:38px;padding: 0 5px 0 5px"}).appendTo($(a));"panoramaSlideIn"==e?($(t).text("Street view"),$(a).on("click",function(){$(s).find(".panorama-pseudo-container").css("margin","0")})):"panoramaSlideOut"==e&&($(t).text("X"),$(a).on("click",function(){$(s).find(".panorama-pseudo-container").css("margin",r)}))}})}}(jQuery);